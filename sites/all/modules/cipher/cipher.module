<?php

    function cipher_menu() {

        $items = array();
        $items['cipher_rules'] = array(
        'title' => 'Cipher Rules',
        'page callback' => 'drupal_get_form',
        'page arguments' => array('cipher_form'),
        'access callback' => TRUE,
        'type' => MENU_NORMAL_ITEM,
        );
        $items['cipher_results'] = array(
        'title' => 'Results',
        'page callback' => 'cipher_encode',
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
        );
        return $items;
    }

    function cipher_form() {
     $form['shift_value'] = array(
       '#title' => 'shift_value',
       '#type' => 'textfield',
       '#description' => t('Please enter the shift value'),
       '#required' => TRUE,
       '#element_validate' => array('element_validate_integer_positive'),
     );
     $form['shift_direction'] = array(
       '#title' => 'shift_direction',
       '#type' => 'textfield',
       '#description' => t('Please enter the shift direction'),
       '#required' => TRUE,
       '#element_validate' => array ('element_validate_value'),
     );
     $form['phrase'] = array(
       '#title' => 'phrase',
       '#type' => 'textfield',
       '#description' => t('Please enter a phrase'),
       '#required' => TRUE,
     );
     $form['submit'] = array(
       '#type' => 'submit',
       '#value' => 'Encrypt',
       '#required' => TRUE,
     );
     return $form;
   }

   function element_validate_value($element) {
     if($element['#value'] != "right" && $element['#value'] != "left") {
       var_dump($element['#value']);
       var_dump("right");
       form_error($element , t('Please enter left or right'));
     }
   }


    function cipher_form_submit($form, &$form_state) {
    $shift_value = $form_state['values']['shift_value'];
    $shift_direction = $form_state['values']['shift_direction'];
    $phrase = $form_state['values']['phrase'];
    $_SESSION['shift_value'] = $shift_value;
    $_SESSION['shift_direction'] = $shift_direction;
    $_SESSION['phrase'] = $phrase;
    $form_state['redirect'] = 'cipher_results';
    }

   function cipher_encode() {
     $output = array();
     $shift_value = $_SESSION['shift_value'];
     $shift_direction = $_SESSION['shift_direction'];
     $phrase = $_SESSION['phrase'];
     $alphabet = array('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z');
     $lower_phrase = strtolower($phrase);
     $split_phrase = str_split($lower_phrase,1);

     for($i=0; $i < count($alphabet); $i++) {
       for($i=0; $i < count($split_phrase); $i++) {
            if($split_phrase[$i] === $alphabet[$i]) {
                $letter = $alphabet[$i] + $shift_value;
                var_dump($letter);
                array_push($output, $letter);
            }
       }
     }
     return $output;
   }
